var e = require("node:path");

var r = require("ts-morph");

var a = require("@0no-co/graphqlsp/api");

var t = require("./index-chunk.js");

function _interopNamespaceDefault(e) {
  var r = Object.create(null);
  if (e) {
    Object.keys(e).forEach((function(a) {
      if ("default" !== a) {
        var t = Object.getOwnPropertyDescriptor(e, a);
        Object.defineProperty(r, a, t.get ? t : {
          enumerable: !0,
          get: function() {
            return e[a];
          }
        });
      }
    }));
  }
  r.default = e;
  return r;
}

var i = _interopNamespaceDefault(e);

var n = t.expose((async function* _runTurbo(e) {
  a.init({
    typescript: r.ts
  });
  var n = i.dirname(e.configPath);
  var s = new r.Project({
    tsConfigFilePath: e.configPath,
    skipAddingFilesFromTsConfig: !0
  });
  s.createSourceFile("__gql-tada-override__.d.ts", l, {
    overwrite: !0,
    scriptKind: r.ScriptKind.TS
  });
  s.addSourceFilesFromTsConfig(e.configPath);
  var p = s.getSourceFiles().filter((r => {
    var a = i.resolve(n, r.getFilePath());
    return !i.relative(e.rootPath, a).startsWith("..");
  }));
  yield {
    kind: "FILE_COUNT",
    fileCount: p.length
  };
  var c = s.getTypeChecker().compilerObject;
  for (var {compilerNode: u} of p) {
    var g = u.fileName;
    var f = {};
    var d = [];
    var y = findAllCallExpressions(u, e.pluginConfig);
    for (var m of y) {
      var v = c.getTypeAtLocation(m);
      var T = c.getTypeAtLocation(m.arguments[0]);
      if (!v.symbol || "TadaDocumentNode" !== v.symbol.getEscapedName()) {
        var F = t.getFilePosition(u, m.getStart());
        d.push({
          message: 'The discovered document is not of type "TadaDocumentNode".\nIf this is unexpected, please file an issue describing your case.',
          file: g,
          line: F.line,
          col: F.col
        });
        continue;
      }
      f["value" in T && "string" == typeof T.value && 0 == (T.flags & r.TypeFlags.StringLiteral) ? JSON.stringify(T.value) : c.typeToString(T, m, o)] = c.typeToString(v, m, o);
    }
    yield {
      kind: "FILE_TURBO",
      filePath: g,
      cache: f,
      warnings: d
    };
  }
}));

var o = r.TypeFormatFlags.NoTruncation | r.TypeFormatFlags.NoTypeReduction | r.TypeFormatFlags.InTypeAlias | r.TypeFormatFlags.UseFullyQualifiedType | r.TypeFormatFlags.GenerateNamesForShadowedTypeParams | r.TypeFormatFlags.UseAliasDefinedOutsideCurrentScope | r.TypeFormatFlags.AllowUniqueESSymbolType | r.TypeFormatFlags.WriteTypeArgumentsOfSignature;

var l = "\nimport * as _gqlTada from 'gql.tada';\ndeclare module 'gql.tada' {\n  interface setupCache {\n    readonly __cacheDisabled: true;\n  }\n}\n".trim();

function findAllCallExpressions(e, a) {
  var t = [];
  var i = new Set([ a.template, "graphql", "gql" ].filter(Boolean));
  !function find(e) {
    if (r.ts.isCallExpression(e) && i.has(e.expression.getText())) {
      t.push(e);
      return;
    } else {
      r.ts.forEachChild(e, find);
    }
  }(e);
  return t;
}

exports.runTurbo = n;
//# sourceMappingURL=thread-chunk2.js.map
